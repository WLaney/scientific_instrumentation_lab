% This is style of APS journal, physicists should aim to use it
\documentclass[prl,12pt,notitlepage,aps,onecolumn,superscriptaddress]{revtex4-1}

%---------------------------------------------------------------
\usepackage{listings} % allow to include nicely formated listings
\usepackage{xcolor}   % we can add and use colors
\usepackage{fullpage} % default article style is to greedy about margins
\usepackage{graphicx} % REQUIRED TO WORK WITH FIGURES
\usepackage{amsmath,amssymb} % much better math and equation handling
\usepackage{booktabs}
\usepackage{float}
%---------------------------------------------------------------

\begin{document}
%---------------------------------------------------------------
\title{Lab 06 Report}
\author{William Laney \& Michael Kopreski}
\date{October 19, 2016}
\maketitle

\section{Group Member Roles}
Circuit Architect: William

Resource Manager (collected and tested components): William

Hardware Specialist (assembled the circuit): William

Programer: Michael

QA Specialist: Michael

\section{Initial set up and testing}
We began this lab by wiring the MCP4725 to the raspberry pi using the I$^2$C bus, a picture can be seen in figure 1. We then wrote code to have the DAC output a constant voltage, this code can be seen in the appendix, listing 1. We compared the voltage we asked for from the Pi to the output voltage provided by the DAC. The results of this can be seen in table 1. A plot of the percent error between the requested and actual output can be seen in figure 2. From this figure we see that the error is always below 3\% in the chip's operating range, we also see that the chip seems to have lower error between 1.5V to the rail. More data points need to be taken in order to determine if this a true characteristic of the chip.

\begin{figure}[h]
\begin{center}
\includegraphics[width=.3\columnwidth]{cir.jpg}
\end{center}
\caption{\label{fig:pic} Circuit}
\end{figure}

% Table generated by Excel2LaTeX from sheet 'Sheet1'
\begin{table}[htbp]
 \centering
 \caption{DC Data}
   \begin{tabular}{c|c|c|c}
   \toprule
   Input & Expected Output Voltage & Output Voltage & Percent Error \\
   \midrule
   4095  & 4.74884033 & 4.756 & 0.00150767 \\
   3583  & 4.15509033 & 4.176 & 0.0050323 \\
   3071  & 3.56134033 & 3.586 & 0.00692427 \\
   2559  & 2.96759033 & 2.966 & 0.0005359 \\
   2047  & 2.37384033 & 2.386 & 0.00512236 \\
   1535  & 1.78009033 & 1.786 & 0.00331987 \\
   1023  & 1.18634033 & 1.216 & 0.02500098 \\
   767   & 0.88946533 & 0.903 & 0.01521663 \\
   511   & 0.59259033 & 0.588 & 0.00774621 \\
   255   & 0.29571533 & 0.288 & 0.0260904 \\
   0     & 0     & 0.007 & Inf \\
   \bottomrule
   \end{tabular}%
 \label{tab:addlabel}%
\end{table}%


\begin{figure}[h]
\begin{center}
\includegraphics[width=.7\columnwidth]{plot.png}
\end{center}
\caption{\label{fig:pic} Percent Error vs. Expected Output}
\end{figure}

\section{Creating a Function Generator}
Next wrote code that would allow the Pi to output either a square wave or sine wave at varying frequencies. This code can be seen in the appendix in listing 2. We found by looking at the output on the scope that maximum frequency we could output the square wave was 95$\pm2$Hz. The square wave was stable with just a little wobble at the top of the wave. A picture of thic can be seen in figure 3.

\begin{figure}[h]
\begin{center}
\includegraphics[width=.3\columnwidth]{95sq.jpg}
\end{center}
\caption{\label{fig:pic} 95Hz Square wave from Pi}
\end{figure}

Next we moved on to test the fast fourier transform (FFT) feature of the scopes. To do this we attached the function generator outputting a 10kHz sine wave to the input of the scope. We then performed a FFT on this wave form. From it we found that the second harmonic was 40db below the fundamental. The largest harmonic was at 20kHz. A picture of the FFT can be seen in figure 4.

\begin{figure}[h]
\begin{center}
\includegraphics[width=.3\columnwidth]{10kfft.jpg}
\end{center}
\caption{\label{fig:pic} FFT of 10k sine waveform function generator}
\end{figure}

Now that we had experience with the scope's FFT functionality we used this feature on the Pi. We started by finding the highest frequency sine wave the pi could output. We found this to be about 95Hz. This is consistent with the maximum frequency of the square wave, so this makes sense. We performed an FFT on this wave form and found the largest harmonic to be 25db. This can be seen in figure 5.

\begin{figure}[h]
\begin{center}
\includegraphics[width=.3\columnwidth]{95fft.jpg}
\end{center}
\caption{\label{fig:pic} FFT of 95Hz sine wave from pi}
\end{figure}

We were not able to increase the maximum frequency of our sine wave. To do this you would need the Pi to run faster, this could be accomplished with code improvements, or using a lower level language such as C.

You can decide the amplitude of the largest harmonic by decreasing the frequency. A picture of this can be seen in figure 6.

\begin{figure}[h]
\begin{center}
\includegraphics[width=.3\columnwidth]{47fft.jpg}
\end{center}
\caption{\label{fig:pic} FFT of 47Hz sine wave from Pi}
\end{figure}

We were able to generate at 190hz sine wave while keeping the second harmonic at least 20dB lower. However at this frequency the sine wave was very messy.

\section{Conclusion}
In this lab we learned about the I$^2$C protocol. We also learned about DACs. DACs take a multi bit digital value and output a corresponding DC analog voltage. Additionally we learned about creating waveforms with a DAC and how to use the math functions in the scope to analyses these waveforms. Finally we learned about the relation between wave from frequency and the harmonics it produces.

\section{Appendix}

\lstinputlisting[language=Python, caption=DC voltage, label=amb]{bb_code_lab6.py}

\lstinputlisting[language=Python, caption=Function generator, label=amb]{adc.py}

\end{document}

